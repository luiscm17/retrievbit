---
import { getEntries, getIndex } from "@lib/contentParser";
import EntryLayout from "@components/home/EntryLayout.astro";
import type { HomeEntry, SearchableEntry, TrainingEntry } from "@/types";
import { getCollection, type CollectionEntry } from "astro:content";
import { getGroups } from "@lib/contentParser";
import { sortByTitle } from "@lib/sortFunctions";

const lang = Astro.url.pathname.split("/")[1] || "es";

// Obtener entradas tipadas correctamente

const searchableCollections = [
  "about",
  "authors",
  "blog",
  "training",
  "concepts",
  "portfolio",
  "tutorials",
  "terms",
] as const;

const allEntries = await Promise.all(
  searchableCollections.map(collection => 
    getEntries(collection, lang, undefined, true, true)
  )
);

const entry = (await getIndex("home", lang)) as HomeEntry;
const searchList = allEntries.flat() as SearchableEntry[];
const groupIndices = (await getGroups("training", lang, sortByTitle)) as TrainingEntry[];
---

<EntryLayout entry={entry} entries={groupIndices} searchList={searchList} />
